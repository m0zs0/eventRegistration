# 1. Laravel projekt
C:\xampp\htdocs>composer create-project laravel/laravel eventRegistration
cd eventRegistration

# 2. .env kulcsbeállítás (tiszta telepítés esetén nem kell)
cp .env.example .env
php artisan key:generate

# 3. .env adatbázis
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=event_registration
DB_USERNAME=root
DB_PASSWORD=


*config/app.php módosítása*
```php
    'timezone' => 'Europe/Budapest',`
```

composer require laravel/sanctum

php artisan vendor:publish --provider="Laravel\Sanctum\SanctumServiceProvider"


# 4. User migráció és modell (+kapcsolatok)
// database/migrations/..._create_users_table.php
$table->string('phone')->nullable();
$table->boolean('is_admin')->default(false);
$table->softDeletes();

// app/Models/User.php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\SoftDeletes;
use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;
use Laravel\Sanctum\Contracts\HasApiTokens;

class User extends Authenticatable
{
    /** @use HasFactory<\Database\Factories\UserFactory> */
    use HasFactory, Notifiable, SoftDeletes, HasApiTokens;

    /**
     * The attributes that are mass assignable.
     *
     * @var list<string>
     */
    protected $fillable = [
        'name',
        'email',
        'password',
        'phone',
        'is_admin',
    ];

    /**
     * The attributes that should be hidden for serialization.
     *
     * @var list<string>
     */
    protected $hidden = [
        'password',
        'remember_token',
    ];

    /**
     * Get the attributes that should be cast.
     *
     * @return array<string, string>
     */
    protected function casts(): array
    {
        return [
            'email_verified_at' => 'datetime',
            'password' => 'hashed',
        ];
    }

    public function registrations()
    {
        return $this->hasMany(Registration::class);
    }

    public function events()
    {
        return $this->belongsToMany(Event::class, 'registrations')
            ->withPivot('status', 'registered_at')
            ->withTimestamps();
    }
}


# 5. Event migráció és modell (+kapcsolatok)
php artisan make:model Event -m

// database/migrations/..._create_events_table.php
Schema::create('events', function (Blueprint $table) {
    $table->id();
    $table->string('title');
    $table->text('description')->nullable();
    $table->dateTime('date');
    $table->string('location');
    $table->integer('max_attendees');
    $table->softDeletes();
    $table->timestamps();
});

app/Models/Event.php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\SoftDeletes;

class Event extends Model
{
    use HasFactory, SoftDeletes;
    
    protected $fillable = ['name', 'date', 'location', 'description'];

    protected $casts = [
        'date' => 'datetime',
    ];

    public function registrations()
    {
        return $this->hasMany(Registration::class);
    }

    public function users()
    {
        return $this->belongsToMany(User::class, 'registrations')
            ->withPivot('status', 'registered_at', 'deleted_at')
            ->withTimestamps();
    }
}



# 6. Registration migráció és modell (+kapcsolatok)
php artisan make:model Registration -m

// database/migrations/..._create_registrations_table.php
Schema::create('registrations', function (Blueprint $table) {
    $table->id();
    $table->foreignId('user_id')->constrained()->onDelete('cascade');
    $table->foreignId('event_id')->constrained()->onDelete('cascade');
    $table->enum('status', ['függőben', 'elfogadva', 'elutasítva'])->default('függőben');
    $table->timestamp('registered_at')->useCurrent();
    $table->timestamps();
    $table->softDeletes();
    $table->unique(['user_id', 'event_id']); // Egy user csak egyszer jelentkezhet
});

app/Models/Registration.php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\SoftDeletes;

class Registration extends Model
{
    use HasFactory, SoftDeletes;

    protected $fillable = [
        'user_id',
        'event_id',
        'status',
        'registered_at'
    ];

    public function user()
    {
        return $this->belongsTo(User::class);
    }

    public function event()
    {
        return $this->belongsTo(Event::class);
    }

}


#7. php artisan migrate

#8. Factory-k létrehozása
php artisan make:factory EventFactory --model=Event
php artisan make:factory RegistrationFactory --model=Registration

------------------------------------------
UserFactory.php

<?php

namespace Database\Factories;

use Illuminate\Database\Eloquent\Factories\Factory;
use Illuminate\Support\Facades\Hash;
use Illuminate\Support\Str;

/**
 * @extends \Illuminate\Database\Eloquent\Factories\Factory<\App\Models\User>
 */
class UserFactory extends Factory
{
    /**
     * Define the model's default state.
     *
     * @return array<string, mixed>
     */
    public function definition(): array
    {

        $faker = \Faker\Factory::create('hu_HU');

        $firstName = $faker->firstName;
        $lastName = $faker->lastName;
        $randomNumber = rand(10, 99);

        return [
            'name' => $firstName . ' ' . $lastName,
            'email' => strtolower(Str::ascii($firstName) . '.' . Str::ascii($lastName)) . $randomNumber .'@events.hu',
            'phone' => $faker->numerify('+36## ### ####'),
            //'is_admin' => false,
            'email_verified_at' => now(),
            'password' => bcrypt('jelszo123'), 
            'remember_token' => Str::random(10),
        ];
    }
}
--------------------------

EventFactory.php

<?php

namespace Database\Factories;

use Illuminate\Database\Eloquent\Factories\Factory;
use Illuminate\Support\Carbon;

/**
 * @extends \Illuminate\Database\Eloquent\Factories\Factory<\App\Models\Event>
 */
class EventFactory extends Factory
{
    /**
     * Define the model's default state.
     *
     * @return array<string, mixed>
     */
    public function definition(): array
    {
        $eventTypes = [
            'Tech konferencia',
            'Marketing workshop',
            'Üzleti találkozó',
            'Művészeti kiállítás',
            'Tudományos előadás',
            'Közösségi esemény',
            'Sportverseny',
            'Zenei fesztivál',
            'Képzési nap',
            'Hálózatépítő esemény'
        ];

        $topics = [
            'Innovatív technológiák',
            'Digitális marketing trendek',
            'Vállalkozásfejlesztés',
            'Művészet és kreativitás',
            'Tudományos kutatások',
            'Közösségi fejlődés',
            'Fenntarthatóság',
            'Személyes fejlődés'
        ]; 

        $locations = [
            'Budapest, BME Q épület',
            'Budapest, Corvinus Egyetem',
            'Online (Zoom)',
            'Szeged, SZTE',
            'Debrecen, Egyetem',
            'Pécs, PTE',
            'Győr, Széchenyi Egyetem',
            'Miskolc, Műszaki Egyetem',
            'Veszprém, Pannon Egyetem',
            'Budapest, Magvető Café'
        ];

        return [
            'title' => $this->faker->randomElement($eventTypes),
            'description' => $this->faker->randomElement($topics),
            'date' => $this->faker->dateTimeBetween('-1 month', '+6 months'),
            'location' => $this->faker->randomElement($locations),
            'max_attendees' => $this->faker->numberBetween(10, 200),
        ];
    }
}
----------------------

RegistrationFactory.php

<?php

namespace Database\Factories;

use Illuminate\Database\Eloquent\Factories\Factory;
use App\Models\User;
use App\Models\Event;

/**
 * @extends \Illuminate\Database\Eloquent\Factories\Factory<\App\Models\Registration>
 */
class RegistrationFactory extends Factory
{
    /**
     * Define the model's default state.
     *
     * @return array<string, mixed>
     */
    public function definition(): array
    {
        return [
            'user_id' => User::factory(),
            'event_id' => Event::factory(),
            'status' => $this->faker->randomElement(['függőben', 'elfogadva', 'elutasítva']),
            'registered_at' => now(),
        ];
    }
}

#9. Seeder-ek létrehozása
php artisan make:seeder UserSeeder
php artisan make:seeder EventSeeder
php artisan make:seeder RegistrationSeeder

--------------------------------
UserSeeder.php

<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\User;
use Illuminate\Support\Facades\Hash;

class UserSeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        // Admin felhasználó
        User::factory()->create([
            'name' => 'Admin',
            'email' => 'admin@events.hu',
            'password' => Hash::make('admin123'),
    	    'is_admin' => true,
        ]);

        // Teszt felhasználó
        User::factory()->create([
            'name' => 'Test',
            'email' => 'test@events.hu',
            'password' => Hash::make('test123'),
        ]);

        // További random felhasználók
        User::factory()->count(10)->create();
        
        $this->command->info('UserSeeder: 12 felhasználó létrehozva (1 admin, 1 test, 10 random).');
    }
}


-------------------------
EventSeeder.php

<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\Event;

class EventSeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        // Fix dátumú példa események
        $events = [
            [
                'title' => 'Tech Conference 2024',
                'description' => 'Éves technológiai konferencia innovatív témákkal.',
                'date' => now()->addDays(30),
                'location' => 'Budapest, BME Q épület',
                'max_attendees' => 100,
            ],
            [
                'title' => 'Marketing Workshop',
                'description' => 'Gyakorlati marketing workshop digitális trendekkel.',
                'date' => now()->addDays(15),
                'location' => 'Online (Zoom)',
                'max_attendees' => 50,
            ],
            [
                'title' => 'Webfejlesztés Alapjai',
                'description' => 'Kezdőknek szóló webfejlesztési tréning.',
                'date' => now()->subDays(10), // Múltbeli
                'location' => 'Debrecen, Egyetem',
                'max_attendees' => 40,
            ],
        ];

        foreach ($events as $event) {
            Event::create($event);
        }

        // Factory-val létrehozott random események
        Event::factory()->count(10)->create();
        $this->command->info("EventSeeder: 13 esemény létrehozva (3 fix + 10 random).");
    }
}
--------------------------
RegistrationSeeder.php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\Registration;
use App\Models\User;
use App\Models\Event;

class RegistrationSeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        $users = User::all();
        $events = Event::all();

        $sampleRegistrations = [
            [
                'user_id' => $users[1]->id,
                'event_id' => $events[0]->id,
                'status' => 'elfogadva',
                'registered_at' => now()->subDays(5),
            ],
            [
                'user_id' => $users[1]->id,
                'event_id' => $events[0]->id,
                'status' => 'függőben',
                'registered_at' => now()->subDays(3),
            ],
            [
                'user_id' => $users[2]->id,
                'event_id' => $events[1]->id,
                'status' => 'elfogadva',
                'registered_at' => now()->subDays(7),
            ],
            [
                'user_id' => $users[3]->id,
                'event_id' => $events[2]->id,
                'status' => 'elutasítva',
                'registered_at' => now()->subDays(10),
            ],
        ];

        foreach ($sampleRegistrations as $registration) {
            Registration::create($registration);
        }

        // Random jelentkezések generálása
        foreach ($users as $user) {
            $randomEvents = $events->random(rand(1, 3)); // minden userhez 1-3 random event

            foreach ($randomEvents as $event) {
                $exists = Registration::where('user_id', $user->id)
                    ->where('event_id', $event->id)
                    ->exists();

                if (!$exists) {
                    Registration::create([
                        'user_id' => $user->id,
                        'event_id' => $event->id,
                        'status' => collect(['függőben', 'elfogadva', 'elutasítva'])->random(),
                        'registered_at' => now()->subDays(rand(0, 15)),
                    ]);
                }
            }
        }

        $this->command->info("RegistrationSeeder: 4 fix és x véletlenjelentkezés létrehozva.");
    }
}
------------------------------
DatabaseSeeder.php
<?php

namespace Database\Seeders;

use App\Models\User;
use Illuminate\Database\Console\Seeds\WithoutModelEvents;
use Illuminate\Database\Seeder;

class DatabaseSeeder extends Seeder
{
    use WithoutModelEvents;

    /**
     * Seed the application's database.
     */
    public function run(): void
    {
        $this->call([
            UserSeeder::class,
            EventSeeder::class,
            RegistrationSeeder::class,
        ]);
    }
}


#10. Adatbázis feltöltése

php artisan db:seed

******************************************************
#11. API útvonalak létrehozása

php artisan install:api

routes/api.php

-------------------------
<?php

use Illuminate\Support\Facades\Route;
use App\Http\Controllers\Api\EventController;
use App\Http\Controllers\Api\RegistrationController;
use App\Http\Controllers\Api\UserController;

/*
|--------------------------------------------------------------------------
| API Routes
|--------------------------------------------------------------------------
*/

// Without authentication
Route::get('/ping', function () {return response()->json(['message' => 'API működik!']);});
Route::post('/login', [\App\Http\Controllers\Api\AuthController::class, 'login']);
Route::post('/register', [\App\Http\Controllers\Api\AuthController::class, 'register']);

// ---------------------------
// Authenticated routes (Sanctum)
// ---------------------------
Route::middleware('auth:sanctum')->group(function () {

    // ---------------------------
    // Event CRUD + regisztráció
    // ---------------------------
    Route::prefix('events')->group(function () {
        Route::get('/', [EventController::class, 'index']);
        Route::get('/upcoming', [EventController::class, 'upcoming']);
        Route::get('/past', [EventController::class, 'past']);
        Route::get('/filter', [EventController::class, 'filter']);

        // Admin only CRUD
        Route::post('/', [EventController::class, 'store']);
        Route::put('/{id}', [EventController::class, 'update']);
        Route::delete('/{id}', [EventController::class, 'destroy']);

        // Registrations
        Route::post('{event}/register', [RegistrationController::class, 'register']);    // user regisztrál
        Route::delete('{event}/unregister', [RegistrationController::class, 'unregister']); // user törli magát
        Route::delete('{event}/users/{user}', [RegistrationController::class, 'adminRemoveUser']); // admin törli usert
    });

    // ---------------------------
    // User CRUD (admin only)
    // ---------------------------
    Route::prefix('users')->group(function () {
        Route::get('/', [UserController::class, 'index']);
        Route::get('/{id}', [UserController::class, 'show']);
        Route::post('/', [UserController::class, 'store']);
        Route::put('/{id}', [UserController::class, 'update']);
        Route::delete('/{id}', [UserController::class, 'destroy']);
    });

    Route::get('/me', [UserController::class, 'me']);
    Route::put('/me', [UserController::class, 'updateMe']);
    Route::post('/logout', [UserController::class, 'logout']);
});

-------------------------

# 12. API controllerek létrehozása
php artisan make:controller API/EventController --api --model=Event
php artisan make:controller API/RegistrationController --api --model=Registration
php artisan make:controller API/UserController --api --model=User
php artisan make:controller API/AuthController









